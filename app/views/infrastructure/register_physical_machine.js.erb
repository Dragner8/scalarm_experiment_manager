vm_json = []
<% @pmachine.virtual_machines.each do |vm| %>
  vm_json.push({'id': 'vm-<%= vm.id %>', 'name': '<%= escape_javascript(render(:partial => "vm_node", :locals => { :vm => vm })) %>' });
<% end %>

pm_json = { 'id': 'pm-<%= @pmachine.id %>', 
            'name': '<%= escape_javascript(physical_machine_label(@pmachine)) %>',
            'children': vm_json }

<% if @error.nil? %>
    infrastructure_tree.addSubtree({'id': '1_1', 'children': [ pm_json ] }, 'replot', { });
<% end %>

$('#register_form').dialog('close');
clear_register_dialog();

<% if @notice.nil? %>
    $(".notice").html("");
    $(".notice").hide();
<% else %>
    $(".notice").html("<%= @notice %>");
    $(".notice").show();
    $('html,body').animate(
	    { scrollTop: $('.notice').offset().top },
		{ duration: 'slow', easing: 'swing'}
	);

    setTimeout("$(\".notice\").html(\"\"); $(\".notice\").hide('slow');", 10000);
<% end %>

<% if @error.nil? %>
    $(".error").html("");
    $(".error").hide();
<% else %>
    $(".error").html("<%= @error %>");
    $(".error").show();
    $('html,body').animate(
	    { scrollTop: $('.error').offset().top },
		{ duration: 'slow', easing: 'swing'}
	);

    setTimeout("$(\".error\").html(\"\"); $(\".error\").hide('slow');", 10000);
<% end %>